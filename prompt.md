```
# 编写一个obsidian插件

> 场景：在阅读长文的时候，能够在尽量不调整原文章格式的情况下对选中文字进行批注，批注需高亮，批注内容存放到另一个文件夹下，支持双向跳转。

功能需求如下
1. PC端
 - 在打开文章后，鼠标支持选中文字，右键-批注，然后提供文本框编写批注内容，批注内容存放到另一个文件夹下（支持配置），文件名定义为"当前文件名-批注.md"。
 - PC端要求写完批注后，可以在文章左右两侧空白初预览批注内容，支持批注隐藏/显示.
 - 点击左右两侧的批注内容可以定位到文章中的具体位置。
 - 查看批注文档时，也可以自动跳转到文章的具体位置。
2. Mobile端
 - Mobile端与PC端数据格式兼容
 - 在打开文章后，选中文字，点击选中文字 出现批注二字，点击批注，提供文本框编写批注内容，批注内容存放到另一个文件夹下（支持配置），文件名定义为"当前文件名-批注.md"。
 - 单击文章中的被批注文字，可以悬浮显示批注内容，批注内容过长时，可以使用滚动条进行滚动查看，避免全覆盖mobile端屏幕
 - 查看批注文档时，也可以自动跳转到文章的具体位置。

代码要求：
- 需要按照obsidian的插件规范进行代码编写。
```

```
经测试，当前插件已支持
- 鼠标选中文字，右键点击批注，弹窗批注，并保存到对应的批注文件中了，编辑模式下批注高亮了，并支持鼠标悬浮显示。批注文件夹支持配置

未实现功能
- 悬浮显示后按Ctrl键，鼠标变成一个手点击的图案，然后跳转到对应的批注文件中。
- 文章右侧显示批注内容（此效果可以想象成word编写批注时显示的效果）

需要优化的点
- 生成的批注文件命名需要调整，假设文章文件名为`article.md`，那么文章批注的文件名为"article-annotation.md",

mobile端暂未测试，先实现PC端的功能再说。
```

```
侧边栏的显示通过命令面板显示不优雅，需要移动到右侧折叠栏的功能区，类似出链列表的那种样式。如果开启插件的情况下，点击文章，右侧功能区自动带此功能
```

```
右侧功能区的批注出现了两个，批注只能批注一次，下一次批注会把前一次的覆盖掉，批注保存后未实时在页面上高亮，需要来回切换一下视图才会显示。
```

```
1. 多次批注后，第一条批注在右侧边栏显示异常。 2.右侧边栏的批注支持编辑（可以替换右下角的定位到原文按钮，因为这里已经有点击记录直接跳转的功能了），修改后同步到批注文件中对应位置。
```

```
主体功能已经ok了，记录下来，以下是需要优化的点，1.把右侧边栏的批注右下角的跳转“批注.md”按钮重新加回来。 2.右侧边栏的高度需要根据批注内容进行自适应，右下角可以补充批注日期时间（鼠标移动上去显示即可，默认隐藏）。 
```

```
关闭obsidian重新打开后右侧批注信息不显示（批注文件仍然在）。右侧边栏的批注编辑后，正文中的悬浮显示没有更新，此外右键新增批注后，高亮有时候不同步，会稍微慢一拍显示。 
```

```
批注编辑后悬浮显示仍然没有刷新数据，此外手指点击这个效果只允许在按住ctrl的时候进行显示，而且只做跳转。原手指点击显示的效果移动到鼠标悬浮处，右侧批注的日期时间（格式26-02-12 11:51）移动到左下角，避免和按钮重叠。
```

```
删除鼠标悬浮显示功能，改成双击显示，显示后保持 然后可以使用滚动条下拉，支持右下角点击编辑保存。按住ctrl+鼠标左键 调整至批注文件对应位置。
```

```
经测试，未删除鼠标悬浮显示功能，需要确认一下，目前需要新增功能，1.点击文章中批注 需要自动定位到右侧功能栏的对应批注记录。2.Ctrl+鼠标左击需要定位到批注文件的对应批注下，而不是标题。
```

```
关于鼠标悬浮显示的描述可能有误，请检查一下tooltip，还有个需要优化的点是当点击右侧的批注栏是，左侧正文的对应批注做一个选中的效果。
```

```
我仔细描述一下悬浮显示的现象，首先我鼠标移动到正文批注的位置 鼠标旁边显示了批注内容（内容正确），但是当我在右侧侧边栏修改了批注内容后，他显示还是旧的数据。目前已经有双击显示的功能了，所以我想隐藏这个悬浮显示的功能。此外我现在需要一个删除批注的功能，1.右侧批注处右下角补充一个删除的按钮。2.双击显示内容时，编辑旁边也加一个删除按钮，原编辑字样按钮改成和右侧侧边栏一样的图标。 3. 删除操作后，正文中对应高亮效果删除，右侧侧边栏对应的批注删除，批注文件中相关的批注内容也一并删除。4. 删除过程仅对批注文件有效，仍然不要对原文章进行操作。
```